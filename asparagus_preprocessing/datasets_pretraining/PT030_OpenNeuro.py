import os
import shutil
from asparagus_preprocessing.utils.detect import recursive_find_and_group_files, get_bvals_and_bvecs_v1, recursive_find_files
from asparagus_preprocessing.configs.preprocessing_presets import (
    get_noresampling_preprocessing_config,
    get_FOMO300K_saving_config,
)
from asparagus_preprocessing.utils.metadata_generation import postprocess_standard_dataset
from asparagus_preprocessing.paths import get_data_path, get_source_path
from asparagus_preprocessing.utils.path import get_image_output_paths
from asparagus_preprocessing.utils.mp import multiprocess_mri_dwi_pet_perf_cases
from asparagus_preprocessing.utils.parser import asparagus_parser
from asparagus_preprocessing.utils.dataclasses import DatasetConfig
from asparagus_preprocessing.utils.bids import extract_demographics, rename_files_with_mapping

DATASET_SPECIFIC_CONFIGS = {
    "ds000001": {"default_group": "Control"},
    "ds000002": {"default_group": "Control"},
    "ds000003": {"default_group": "Control"},
    "ds000005": {"default_group": "Control"},
    "ds000006": {"default_group": "Control"},
    "ds000007": {"default_group": "Control"},
    "ds000008": {"default_group": "Control"},
    "ds000009": {"default_group": "Control"},
    "ds000011": {"default_group": "Control"},
    "ds000017": {"default_group": "Control"},
    "ds000051": {"default_group": "Control"},
    "ds000052": {"default_group": "Control"},
    "ds000053": {"default_group": "Control"},
    "ds000101": {"default_group": "Control"},
    "ds000102": {"default_group": "Control"},
    "ds000105": {"default_group": "Control"},
    "ds000107": {"default_group": "Control"},
    "ds000108": {"default_group": "Control"},
    "ds000109": {"default_group": "Control"},
    "ds000110": {"default_group": "Control"},
    "ds000113": {"default_group": "Control"},
    "ds000114": {"default_group": "Control"},
    "ds000116": {"default_group": "Control"},
    "ds000117": {"default_group": "Control"},
    "ds000119": {"default_group": "Control"},
    "ds000120": {"default_group": "Control"},
    "ds000121": {"default_group": "Control"},
    "ds000122": {"default_group": "Control"},
    "ds000133": {"group_mapping": {"MODAFINIL": "Control", "PLACEBO": "Control"}},
    "ds000140": {"default_group": "Control"},
    "ds000144": {"handedness_mapping": {1: "R", 2: "L"}},
    "ds000148": {"default_group": "Control"},
    "ds000149": {"default_group": "Control"},
    "ds000157": {"default_group": "Control"},
    "ds000158": {"default_group": "Control"},
    "ds000164": {"default_group": "Control"},
    "ds000168": {"default_group": "Control"},
    "ds000170": {"default_group": "Control"},
    "ds000172": {"default_group": "Control"},
    "ds000174": {"group_mapping": {"HC": "Control", "CB": "Heavy cannabis user"}},
    "ds000200": {"default_group": "Control"},
    "ds000201": {"group_mapping": {"Young": "Control", "Old": "Control"}},
    "ds000202": {"default_group": "Control"},
    "ds000203": {"default_group": "Control"},
    "ds000204": {"default_group": "Traumatic brain injury"},
    "ds000205": {"default_group": "Control"},
    "ds000206": {"default_group": "Control"},
    "ds000208": {"group_mapping": {"control": "Control", "patient": "Osteoarthritis"}},
    "ds000210": {"default_group": "Control"},
    "ds000212": {"group_mapping": {"NT": "NeuroTypical", "ASD": "Autism Spectrum Disorder"}},
    "ds000214": {"group_mapping": {"Control": "Control", "Patient": "Borderline Personality Disorder"}},
    "ds000216": {"default_group": "Control"},
    "ds000217": {"group_mapping": {"1": "Control", "2": "Control", "3": "Control", "4": "Control"}},
    "ds000218": {"default_group": "Control"},
    "ds000219": {"default_group": "Control"},
    "ds000221": {"default_group": "Control"},
    "ds000222": {"group_mapping": {"young": "Control", "old": "Control"}},
    "ds000223": {"default_group": "Control"},
    "ds000224": {"default_group": "Control"},
    "ds000228": {
        "group_mapping": {
            "3yo": "Control",
            "4yo": "Control",
            "5yo": "Control",
            "7yo": "Control",
            "8-12yo": "Control",
            "Adult": "Control",
        }
    },
    "ds000229": {"default_group": "Control"},
    "ds000231": {"default_group": "Control"},
    "ds000232": {"default_group": "Control"},
    "ds000233": {"default_group": "Control"},
    "ds000234": {"default_group": "Control"},
    "ds000235": {"default_group": "Control"},
    "ds000236": {"default_group": "Control"},
    "ds000237": {"default_group": "Control"},
    "ds000238": {"default_group": "Control"},
    "ds000239": {"default_group": "Control"},
    "ds000240": {"default_group": "Control"},
    "ds000241": {"default_group": "Control"},
    "ds000243": {"default_group": "Control"},
    "ds000244": {"default_group": "Control"},
    "ds000245": {
        "group_mapping": {
            "HC": "Control",
            "PD-SH": "Parkinson’s - severe hyposmia",
            "PD-N/MH": "Parkinson’s - no/mild hyposmia",
        }
    },
    "ds000246": {"default_group": "Control"},
    "ds000247": {"default_group": "Control"},
    "ds000248": {"default_group": "Control"},
    "ds000249": {
        "default_group": "Control",
        "sex_mapping": {0: "M", 1: "F"},
    },
    "ds000253": {"group_mapping": {"Gamer": "Control", "Non-gamer": "Control"}},
    "ds000254": {"default_group": "Control"},
    "ds000255": {"default_group": "Control"},
    "ds000258": {"default_group": "Control"},
    "ds001105": {"default_group": "Control"},
    "ds001110": {"default_group": "Control"},
    "ds001131": {"default_group": "Control"},
    "ds001132": {"default_group": "Control"},
    "ds001145": {"default_group": "Control"},
    "ds001168": {"default_group": "Control"},
    "ds001178": {"default_group": "Control"},
    "ds001228": {"default_group": "Control"},
    "ds001229": {"default_group": "Control"},
    "ds001232": {"default_group": "Control"},
    "ds001233": {"group_mapping": {"trained": "Control", "control": "Control"}},
    "ds001235": {"default_group": "Control"},
    "ds001241": {"default_group": "Control"},
    "ds001242": {"group_mapping": {"younger": "Control", "older": "Control"}},
    "ds001246": {"default_group": "Control"},
    "ds001297": {"default_group": "Control"},
    "ds001299": {"default_group": "Control"},
    "ds001302": {"default_group": "Control"},
    "ds001306": {"default_group": "Control"},
    "ds001338": {"default_group": "Control"},
    "ds001339": {"default_group": "Control"},
    "ds001344": {"default_group": "Control"},
    "ds001345": {"default_group": "Control"},
    "ds001357": {"default_group": "Control"},
    "ds001365": {"default_group": "Control"},
    "ds001371": {"group_mapping": {"control": "Control", "patient": "Clinical high risk for psychosis"}},
    "ds001378": {"group_mapping": {"CONTROL": "Control", "SCA2": "Spinocerebellar Ataxia Type 2"}},
    "ds001386": {"group_mapping": {"Control": "Control", "TBI": "Traumatic brain injury"}},
    "ds001399": {"group_mapping": {"YA": "Control", "OA": "Control"}},
    "ds001408": {"group_mapping": {"control": "Control", "NF": "Control"}},
    "ds001415": {"default_group": "Control"},
    "ds001417": {"default_group": "Control"},
    "ds001430": {"default_group": "Control"},
    "ds001454": {"group_mapping": {"sleep": "Control", "wake": "Control"}},
    "ds001486": {"default_group": "Control", "sex_mapping": {1: "M", 2: "F"}, "handedness_mapping": {2: "R", 1: "L"}},
    "ds001491": {"default_group": "Control"},
    "ds001497": {"default_group": "Control"},
    "ds001499": {"default_group": "Control"},
    "ds001506": {"default_group": "Control"},
    "ds001510": {"default_group": "Control"},
    "ds001511": {"default_group": "Control"},
    "ds001517": {"default_group": "Control"},
    "ds001521": {"default_group": "Control"},
    "ds001525": {"default_group": "Control"},
    "ds001534": {"default_group": "Control"},
    "ds001545": {"default_group": "Control"},
    "ds001547": {"default_group": "Control"},
    "ds001554": {"default_group": "Control"},
    "ds001555": {"default_group": "Control"},
    "ds001576": {"default_group": "Control"},
    "ds001590": {"default_group": "Control"},
    "ds001595": {"default_group": "Control"},
    "ds001597": {"group_mapping": {"movement": "Control", "cue": "Control"}},
    "ds001607": {"default_group": "Control"},
    "ds001608": {"default_group": "Control"},
    "ds001612": {"default_group": "Control"},
    "ds001614": {"default_group": "Control"},
    "ds001621": {"default_group": "Control"},
    "ds001634": {"default_group": "Control"},
    "ds001635": {"default_group": "Control"},
    "ds001652": {"group_mapping": {"text": "Control", "audio": "Control"}},
    "ds001705": {"default_group": "Control"},
    "ds001715": {"default_group": "Control"},
    "ds001722": {"default_group": "Control"},
    "ds001734": {"group_mapping": {"equalIndifference": "Control", "equalRange": "Control"}},
    "ds001740": {"default_group": "Control"},
    "ds001743": {"group_mapping": {"Control": "Control", "Patient": "Unilateral Glaucoma"}},
    "ds001745": {"default_group": "Control"},
    "ds001747": {"group_mapping": {"LB": "Control", "MC": "Control", "EB": "Control"}},
    "ds001748": {"group_mapping": {"children": "Control", "adolescents": "Control", "adults": "Control"}},
    "ds001751": {"default_group": "Control"},
    "ds001761": {"default_group": "Control"},
    "ds001762": {"default_group": "Control"},
    "ds001771": {"default_group": "Control"},
    "ds001775": {"default_group": "Control"},
    "ds001784": {"group_mapping": {"MDD": "Major depressive disorder", "OCD": "Obsessive compulsive disorder"}},
    "ds001796": {"default_group": "Control"},
    "ds001814": {"default_group": "Control"},
    "ds001832": {"default_group": "Control"},
    "ds001838": {"default_group": "Control"},
    "ds001839": {"default_group": "Control"},
    "ds001840": {"default_group": "Control"},
    "ds001847": {"default_group": "Control"},
    "ds001848": {"default_group": "Control"},
    "ds001882": {"default_group": "Control"},
    "ds001883": {"default_group": "Control"},
    "ds001894": {"default_group": "Control", "sex_mapping": {1: "M", 2: "F"}, "handedness_mapping": {2: "R", 1: "L"}},
    "ds001907": {"group_mapping": {"HC": "Control", "PD": "Parkinson’s disease"}, "handedness_mapping": {1: "R", 2: "L"}},
    "ds001921": {"default_group": "Control"},
    "ds001923": {"default_group": "Control"},
    "ds001926": {"default_group": "Control"},
    "ds001927": {"default_group": "Control"},
    "ds001928": {"group_mapping": {"HC": "Control", "FM": "Fibromyalgia"}},
    "ds001946": {"default_group": "Control"},
    "ds001972": {"default_group": "Control"},
    "ds001978": {"default_group": "Control"},
    "ds001984": {"default_group": "Control"},
    "ds002000": {"default_group": "Control"},
    "ds002001": {"default_group": "Control"},
    "ds002006": {"default_group": "Control"},
    "ds002011": {"default_group": "Control"},
    "ds002013": {"default_group": "Control"},
    "ds002014": {"default_group": "Control"},
    "ds002033": {"default_group": "Control"},
    "ds002041": {"default_group": "Control"},
    "ds002076": {"default_group": "Control"},
    "ds002105": {"default_group": "Control"},
    "ds002144": {"default_group": "Control"},
    "ds002149": {"default_group": "Control"},
    "ds002155": {"default_group": "Control"},
    "ds002158": {"default_group": "Control"},
    "ds002168": {"default_group": "Control"},
    "ds002185": {
        "group_mapping": {
            "control": "Control",
            "NAB-01": "No-Apparent-olfactory-bulb",
            "NAB-02": "No-Apparent-olfactory-bulb",
            "NAB-03": "No-Apparent-olfactory-bulb",
            "NAB-CA": "No-Apparent-olfactory-bulb",
        }
    },
    "ds002207": {"default_group": "Control"},
    "ds002236": {"default_group": "Control", "sex_mapping": {1: "M", 2: "F"}, "handedness_mapping": {2: "R", 1: "L"}},
    "ds002237": {"default_group": "Control"},
    "ds002241": {"default_group": "Control"},
    "ds002242": {"default_group": "Control"},
    "ds002250": {"default_group": "Control"},
    "ds002270": {"default_group": "Control"},
    "ds002294": {"default_group": "Control"},
    "ds002306": {"default_group": "Control"},
    "ds002311": {"default_group": "Control"},
    "ds002316": {"default_group": "Control"},
    "ds002320": {"default_group": "Control"},
    "ds002322": {"default_group": "Control"},
    "ds002330": {"default_group": "Control"},
    "ds002336": {"default_group": "Control"},
    "ds002338": {"default_group": "Control"},
    "ds002345": {"default_group": "Control"},
    "ds002363": {"default_group": "Control"},
    "ds002366": {"default_group": "Control"},
    "ds002382": {"default_group": "Control"},
    "ds002411": {"default_group": "Control"},
    "ds002419": {"group_mapping": {"sugar": "Control", "lcs": "Control", "combo": "Control"}},
    "ds002422": {"default_group": "Control"},
    "ds002424": {
        "group_mapping": {"0": "Control", "1": "Attention deficit hyperactivity disorder"},
        "sex_mapping": {1: "M", 2: "F"},
        "handedness_mapping": {2: "R", 1: "L"},
    },
    "ds002425": {"default_group": "Control"},
    "ds002513": {"default_group": "Control"},
    "ds002522": {"group_mapping": {"Neurotypical": "Control", "ASD": "Autism Spectrum Disorder"}},
    "ds002543": {"default_group": "Control"},
    "ds002547": {"default_group": "Control"},
    "ds002550": {"default_group": "Control"},
    "ds002574": {"default_group": "Control"},
    "ds002578": {"default_group": "Control"},
    "ds002596": {"default_group": "Control"},
    "ds002603": {"default_group": "Control"},
    "ds002606": {"default_group": "Control"},
    "ds002608": {"default_group": "Control"},
    "ds002609": {"default_group": "Control"},
    "ds002620": {"default_group": "Control"},
    "ds002634": {"default_group": "Control"},
    "ds002643": {"default_group": "Control"},
    "ds002647": {"group_mapping": {"HC": "Control", "LU": "Control", "PM": "Control"}},
    "ds002655": {"default_group": "Control"},
    "ds002672": {"default_group": "Control"},
    "ds002674": {"default_group": "Control"},
    "ds002685": {"default_group": "Control"},
    "ds002687": {"sex_mapping": {1: "M", 2: "F"}},  # Not clear who is ADHD and who is HC
    "ds002702": {"default_group": "Control"},
    "ds002711": {"default_group": "Control"},
    "ds002715": {"default_group": "Control"},
    "ds002717": {"group_mapping": {"control": "Control", "RPL": "Repeated Pregnancy Loss"}},
    "ds002725": {"default_group": "Control"},
    "ds002726": {"default_group": "Control"},
    "ds002727": {"default_group": "Control"},
    "ds002731": {"group_mapping": {"audio-visual": "Control", "visual-visual": "Control"}},
    "ds002732": {"default_group": "Control"},
    "ds002734": {"default_group": "Control"},
    "ds002735": {"default_group": "Control"},
    "ds002738": {"default_group": "Control"},
    "ds002739": {"default_group": "Control"},
    "ds002741": {"default_group": "Control"},
    "ds002748": {"group_mapping": {"control": "Control", "depr": "Mild depression"}},
    "ds002766": {"default_group": "Control"},
    "ds002770": {"default_group": "Control"},
    "ds002776": {"group_mapping": {"1": "Control", "2": "Control"}},
    "ds002785": {"default_group": "Control"},
    "ds002790": {"default_group": "Control"},
    "ds002793": {"default_group": "Control"},
    "ds002797": {"default_group": "Control"},
    "ds002799": {"default_group": "Medically refractory epilepsy"},
    "ds002813": {"default_group": "Control"},
    "ds002837": {"default_group": "Control"},
    "ds002842": {"default_group": "Control"},
    "ds002843": {"default_group": "Control"},
    "ds002872": {"default_group": "Control"},
    "ds002878": {"group_mapping": {"soccer": "Control"}},
    "ds002879": {"default_group": "Control", "sex_mapping": {1: "M", 2: "F"}},
    "ds002886": {"default_group": "Control", "sex_mapping": {1: "M", 2: "F"}, "handedness_mapping": {2: "R", 1: "L"}},
    "ds002896": {"group_mapping": {"0": "Control", "1": "Tinnitus"}},
    "ds002898": {"default_group": "Control"},
    "ds002905": {"default_group": "Control"},
    "ds002936": {"default_group": "Control", "sex_mapping": {1: "M", 0: "F"}},
    "ds002940": {"group_mapping": {"1": "Control", "2": "Control", "3": "Control"}},
    "ds002979": {"default_group": "Control"},
    "ds002989": {"default_group": "Control"},
    "ds002994": {"default_group": "Control"},
    "ds002995": {"default_group": "Control"},
    "ds003007": {
        "group_mapping": {
            "depr_no_treatment": "Depression - no treatment",
            "depr_cbt": "Depression - Cognitive behavioral therapy",
            "depr_nfb": "Depression - rt-fmri neurofeedback treatment",
        }
    },
    "ds003011": {"default_group": "Control"},
    "ds003012": {"default_group": "Control"},
    "ds003017": {"default_group": "Control"},
    "ds003020": {"default_group": "Control"},
    "ds003037": {"sex_mapping": {1: "M", 2: "F"}},
    "ds003047": {"default_group": "Control"},
    "ds003059": {"default_group": "Control"},
    "ds003076": {"default_group": "Control"},
    "ds003078": {"default_group": "Temporal or parietal lobe epilepsy"},
    "ds003082": {"default_group": "Control"},
    "ds003083": {"default_group": "Control"},
    "ds003085": {"default_group": "Control"},
    "ds003089": {"default_group": "Control"},
    "ds003094": {"default_group": "Control"},
    "ds003095": {"default_group": "Control"},
    "ds003096": {"default_group": "Control"},
    "ds003097": {"default_group": "Control"},
    "ds003103": {"default_group": "Control"},
    "ds003114": {"group_mapping": {"FP": "Control", "LP": "Control"}},
    "ds003126": {"group_mapping": {"TD": "Control", "DL": "Dyslexia", "SpD": "Spelling Disorder"}},
    "ds003136": {"default_group": "Control"},
    "ds003138": {"group_mapping": {"control": "Control", "slackline": "Control"}},
    "ds003146": {"group_mapping": {"NonMusician": "Control", "Musician": "Control"}},
    "ds003148": {"default_group": "Control"},
    "ds003151": {"default_group": "Control"},
    "ds003170": {"default_group": "Control"},
    "ds003171": {"default_group": "Control"},
    "ds003176": {"group_mapping": {"eye": "Control"}},
    "ds003216": {"default_group": "Control"},
    "ds003233": {"group_mapping": {"student": "Control", "expert": "Control"}},
    "ds003242": {"default_group": "Control"},
    "ds003340": {"default_group": "Control"},
    "ds003342": {"default_group": "Control"},
    "ds003345": {"default_group": "Control"},
    "ds003346": {"sex_mapping": {1: "M", 2: "F"}},
    "ds003357": {"group_mapping": {"biofeedback": "Control", "control": "Control"}},
    "ds003358": {"default_group": "Control"},
    "ds003381": {"default_group": "Control"},
    "ds003392": {"default_group": "Control"},
    "ds003397": {"group_mapping": {"B": "Control", "BI": "Control", "I": "Control"}},
    "ds003404": {"default_group": "Control"},
    "ds003416": {"default_group": "Control"},
    "ds003424": {"default_group": "Control", "sex_mapping": {1: "M", 0: "F"}},
    "ds003425": {"default_group": "Control"},
    "ds003430": {"default_group": "Control"},
    "ds003436": {"default_group": "Control"},
    "ds003437": {"default_group": "Control"},
    "ds003452": {"default_group": "Control"},
    "ds003453": {"default_group": "Control"},
    "ds003454": {"default_group": "Control"},
    "ds003455": {"default_group": "Control"},
    "ds003459": {"default_group": "Control", "sex_mapping": {1: "M", 2: "F"}},
    "ds003465": {"default_group": "Control"},
    "ds003469": {"default_group": "Control"},
    "ds003470": {"default_group": "Control"},
    "ds003481": {"default_group": "Control"},
    "ds003484": {"default_group": "Control"},
    "ds003499": {"default_group": "Control"},
    "ds003500": {
        "group_mapping": {"Control": "Control", "ADHD": "Attention deficit hyperactivity disorder"},
        "sex_mapping": {1: "M", 2: "F"},
    },
    "ds003505": {"default_group": "Control"},
    "ds003507": {"default_group": "Control"},
    "ds003508": {"default_group": "Control"},
    "ds003511": {"default_group": "Control"},
    "ds003540": {"default_group": "Control"},
    "ds003542": {"group_mapping": {"basic": "Control", "advanced": "Control"}},
    "ds003545": {"default_group": "Control"},
    "ds003548": {"default_group": "Control"},
    "ds003550": {"default_group": "Control"},
    "ds003553": {"default_group": "Control"},
    "ds003554": {"default_group": "Control"},
    "ds003568": {"group_mapping": {"HV": "Control", "MDD": "Major depressive disorder"}},
    "ds003569": {"default_group": "Control"},
    "ds003574": {"group_mapping": {"face": "Control", "maze": "Control"}},
    "ds003592": {"default_group": "Control"},
    "ds003604": {"default_group": "Control"},
    "ds003606": {"default_group": "Control"},
    "ds003612": {"default_group": "Control"},
    "ds003633": {"default_group": "Control"},
    "ds003639": {"default_group": "Control"},
    "ds003643": {"default_group": "Control"},
    "ds003653": {
        "group_mapping": {
            "HCconvertedMDD": "Major depressive disorder",
            "HC": "Control",
            "MDD": "Major depressive disorder",
            "PDD": "Persistent depressive disorder",
        }
    },
    "ds003659": {"default_group": "Control"},
    "ds003661": {"default_group": "Control"},
    "ds003673": {"default_group": "Control"},
    "ds003684": {"default_group": "Control"},
    "ds003688": {"default_group": "Medication-resistant epilepsy"},
    "ds003696": {"default_group": "Control"},
    "ds003707": {"default_group": "Control"},
    "ds003709": {"group_mapping": {"HV": "Control", "MDD": "Major depressive disorder"}},
    "ds003711": {"default_group": "Control"},
    "ds003715": {"default_group": "Control"},
    "ds003716": {"default_group": "Control"},
    "ds003717": {"default_group": "Control"},
    "ds003720": {"default_group": "Control"},
    "ds003721": {"default_group": "Control"},
    "ds003758": {"default_group": "Control"},
    "ds003763": {"group_mapping": {"Aged": "Control", "Young": "Control"}},
    "ds003764": {"default_group": "Control"},
    "ds003768": {"default_group": "Control"},
    "ds003770": {"default_group": "Mild or moderate depression"},
    "ds003772": {"default_group": "Control"},
    "ds003777": {"default_group": "Control"},
    "ds003778": {"default_group": "Control"},
    "ds003782": {"default_group": "Control"},
    "ds003789": {"group_mapping": {"VV3S": "Control"}},
    "ds003791": {"group_mapping": {"HEX": "Control", "Control": "Control"}},
    "ds003798": {"default_group": "Control"},
    "ds003799": {"group_mapping": {"1": "Control", "2": "Control"}},
    "ds003814": {"default_group": "Control"},
    "ds003823": {"default_group": "Control"},
    "ds003826": {"group_mapping": {"EC": "Control", "LC": "Control"}},
    "ds003834": {"default_group": "Control"},
    "ds003835": {"default_group": "Control"},
    "ds003836": {"default_group": "Control"},
    "ds003848": {"default_group": "Epilepsy surgery"},
    "ds003849": {"default_group": "Control"},
    "ds003851": {"default_group": "Control", "sex_mapping": {1: "M", 2: "F"}},
    "ds003858": {"default_group": "Control"},
    "ds003871": {"default_group": "Control"},
    "ds003872": {"default_group": "Control"},
    "ds003877": {"default_group": "Control", "sex_mapping": {1: "F", 2: "M"}},
    "ds003900": {"default_group": "Control"},
    "ds003922": {"default_group": "Control"},
    "ds003927": {"default_group": "Control"},
    "ds003949": {"group_mapping": {"control": "Control", "patient": "Brain aneurysm(s)"}},
    "ds003950": {"default_group": "Control"},
    "ds003967": {"group_mapping": {"template": "Control", "validation": "Control"}},
    "ds003972": {"default_group": "Control"},
    "ds003974": {"default_group": "Control"},
    "ds003988": {"default_group": "Control"},
    "ds003990": {"default_group": "Control"},
    "ds003993": {"default_group": "Control"},
    "ds003999": {"default_group": "Stroke"},
    "ds004006": {"default_group": "Control"},
    "ds004007": {"default_group": "Control"},
    "ds004009": {"default_group": "Control"},
    "ds004021": {"default_group": "Control"},
    "ds004024": {"default_group": "Control"},
    "ds004038": {"default_group": "Control"},
    "ds004042": {"default_group": "Control"},
    "ds004056": {"default_group": "Control"},
    "ds004065": {"default_group": "Control"},
    "ds004073": {"default_group": "Control"},
    "ds004078": {"default_group": "Control"},
    "ds004081": {"default_group": "Control"},
    "ds004086": {"default_group": "Control"},
    "ds004091": {"default_group": "Control"},
    "ds004097": {"default_group": "Control"},
    "ds004101": {"default_group": "Subclinical signs of emotional dysregulation"},
    "ds004102": {"default_group": "Control"},
    "ds004103": {"default_group": "Control"},
    "ds004107": {"default_group": "Control"},
    "ds004109": {"default_group": "Control"},
    "ds004128": {"default_group": "Control"},
    "ds004129": {"default_group": "Control"},
    "ds004130": {"default_group": "Control"},
    "ds004131": {"default_group": "Control"},
    "ds004134": {"default_group": "Control"},
    "ds004141": {"group_mapping": {"exp": "Control", "sham": "Control"}},
    "ds004146": {"group_mapping": {"n/a": "Control"}},
    "ds004158": {"default_group": "Control"},
    "ds004173": {"default_group": "Control"},
    "ds004182": {"default_group": "Control"},
    "ds004187": {"default_group": "Control"},
    "ds004192": {"default_group": "Control"},
    "ds004194": {"group_mapping": {"Patient": "Intractable epilepsy", "patient": "Intractable epilepsy"}},
    "ds004196": {"default_group": "Control"},
    "ds004199": {"group_mapping": {"fcd": "Focal cortical dysplasia", "hc": "Control"}},
    "ds004212": {"default_group": "Control"},
    "ds004213": {"default_group": "Control"},
    "ds004217": {"default_group": "Control"},
    "ds004219": {"default_group": "Control"},
    "ds004226": {"default_group": "Control"},
    "ds004228": {"default_group": "Control"},
    "ds004230": {"default_group": "Control"},
    "ds004259": {"default_group": "Control"},
    "ds004261": {"group_mapping": {"misinfo": "Control"}},
    "ds004271": {"default_group": "Control"},
    "ds004274": {"default_group": "Control"},
    "ds004280": {"default_group": "Control"},
    "ds004283": {"default_group": "Control"},
    "ds004285": {"default_group": "Control"},
    "ds004286": {"default_group": "Control"},
    "ds004299": {"default_group": "Control"},
    "ds004301": {"default_group": "Control"},
    "ds004302": {
        "group_mapping": {
            "HC": "Control",
            "AVH-": "Schizophrenia without current auditory hallucinations",
            "AVH+": "Schizophrenia with current auditory hallucinations",
        }
    },
    "ds004312": {"default_group": "Control"},
    "ds004323": {"default_group": "Control"},
    "ds004327": {"default_group": "Control"},
    "ds004332": {"group_mapping": {"subject": "Control"}},
    "ds004341": {"default_group": "Control"},
    "ds004349": {"default_group": "Control", "sex_mapping": {1: "M", 2: "F"}},
    "ds004359": {"default_group": "Control"},
    "ds004392": {"default_group": "Parkinson’s disease", "sex_mapping": {1: "M", 0: "F"}},
    "ds004393": {"default_group": "Control"},
    "ds004400": {"default_group": "Control"},
    "ds004406": {"default_group": "Control"},
    "ds004440": {"group_mapping": {"Child": "Control", "Adult": "Control"}},
    "ds004443": {"default_group": "Control"},
    "ds004455": {"default_group": "Control"},
    "ds004456": {"default_group": "Control"},
    "ds004466": {"group_mapping": {"control": "Control", "syn": "Synaesthesia"}},
    "ds004469": {"group_mapping": {"Healthy": "Control", "Patient": "Temporal lobe epilepsy"}},
    "ds004470": {"default_group": "Control"},
    "ds004471": {"default_group": "Parkinson’s disease"},
    "ds004473": {"default_group": "Intractable epilepsy"},
    "ds004475": {"default_group": "Control"},
    "ds004478": {"default_group": "Control"},
    "ds004482": {"default_group": "Control"},
    "ds004484": {"default_group": "Control"},
    "ds004488": {"default_group": "Control"},
    "ds004489": {"default_group": "Control"},
    "ds004493": {"default_group": "Control"},
    "ds004496": {"group_mapping": {"multi-session": "Control", "single-session": "Control"}},
    "ds004498": {"default_group": "Perinatal stroke"},
    "ds004499": {"default_group": "Control"},
    "ds004505": {"group_mapping": {"n/a": "Control"}},
    "ds004513": {"default_group": "Control"},
    "ds004516": {"default_group": "Control"},
    "ds004529": {"default_group": "Control"},
    "ds004542": {"default_group": "Control"},
    "ds004544": {"default_group": "Control"},
    "ds004553": {"default_group": "Control"},
    "ds004556": {"default_group": "Control"},
    "ds004557": {"default_group": "Control"},
    "ds004560": {"default_group": "Control"},
    "ds004562": {"default_group": "Control"},
    "ds004581": {"default_group": "Control"},
    "ds004589": {"default_group": "Control"},
    "ds004590": {"default_group": "Control"},
    "ds004592": {"default_group": "Control"},
    "ds004594": {"default_group": "Control"},
    "ds004597": {"default_group": "Control"},
    "ds004604": {"default_group": "Control"},
    "ds004605": {
        "default_group": "Disruptive mood dysregulation disorder or attention-deficit hyperactivity disorder",
        "sex_mapping": {1: "M", -1: "F"},
    },
    "ds004611": {"default_group": "Control"},
    "ds004630": {"default_group": "Control"},
    "ds004631": {"default_group": "Control"},
    "ds004636": {"default_group": "Control"},
    "ds004647": {"default_group": "Control"},
    "ds004648": {"default_group": "Control"},
    "ds004654": {"group_mapping": {"HC": "Control", "FrX": "Fragile X syndrome"}},
    "ds004656": {"default_group": "Control"},
    "ds004662": {"default_group": "Control"},
    "ds004670": {"default_group": "Control"},
    "ds004692": {"default_group": "Control"},
    "ds004697": {"default_group": "Control"},
    "ds004711": {"default_group": "Control"},
    "ds004712": {"default_group": "Control"},
    "ds004715": {"default_group": "Control"},
    "ds004718": {"default_group": "Control"},
    "ds004725": {"group_mapping": {"PL": "Control", "OT": "Control"}},
    "ds004730": {"default_group": "Control"},
    "ds004731": {"default_group": "Control"},
    "ds004733": {"default_group": "Control"},
    "ds004737": {"default_group": "Control"},
    "ds004746": {"default_group": "Control"},
    "ds004765": {"default_group": "Control"},
    "ds004775": {"group_mapping": {"FAN": "Control", "NON-FAN": "Control"}},
    "ds004783": {"group_mapping": {"C": "Control", "D": "Control", "N": "Control"}},
    "ds004786": {"group_mapping": {"CTL": "Control", "DYS": "Dyslexia"}},
    "ds004791": {"group_mapping": {"DD": "Control", "TA": "Control"}},
    "ds004795": {"default_group": "Control"},
    "ds004808": {"default_group": "Control"},
    "ds004814": {"default_group": "Control"},
    "ds004815": {"default_group": "Control"},
    "ds004829": {"default_group": "Control"},
    "ds004835": {"default_group": "Control"},
    "ds004837": {
        "group_mapping": {"HC": "Control", "FESZ": "First-episode schizophrenia", "FEAFF": "First-episode affective psychosis"}
    },
    "ds004848": {"group_mapping": {"Control": "Control", "DP": "Developmental prosopagnosic"}},
    "ds004856": {"default_group": "Control"},
    "ds004866": {"default_group": "Control"},
    "ds004868": {"default_group": "Control"},
    "ds004869": {"default_group": "Control"},
    "ds004873": {"default_group": "Control"},
    "ds004884": {"default_group": "Stroke"},
    "ds004889": {"default_group": "Stroke"},
    "ds004892": {"default_group": "Control"},
    "ds004894": {"default_group": "Control"},
    "ds004917": {"default_group": "Control"},
    "ds004920": {"default_group": "Control"},
    "ds004928": {"default_group": "Control"},
    "ds004935": {
        "default_group": "Anxiety disorders, disruptive mood dysregulation disorder,"
        " or Attention deficit hyperactivity disorder"
    },
    "ds004946": {"default_group": "Control"},
    "ds004957": {"default_group": "Control"},
    "ds004993": {"default_group": "Epilepsy"},
    "ds004996": {"group_mapping": {"human": "Control", "robot": "Control"}},
    "ds005009": {"default_group": "Control"},
    "ds005012": {"sex_mapping": {1: "M", 0: "F"}},
    "ds005025": {"default_group": "Control"},
    "ds005026": {"group_mapping": {"nl": "Control", "hl": "Hearing loss"}},
    "ds005027": {"sex_mapping": {2: "M", 1: "F"}},
    "ds005038": {"group_mapping": {"passiv": "Control", "comp": "Control", "incomp": "Control", "-": "Control"}},
    "ds005050": {"default_group": "Control"},
    "ds005056": {"default_group": "Control"},
    "ds005073": {"group_mapping": {"1": "Bipolar", "2": "Schizophrenia/Schizoaffective"}},
    "ds005075": {"default_group": "Control"},
    "ds005088": {"default_group": "Control"},
    "ds005096": {"default_group": "Intracranial aneurysms"},
    "ds005115": {"default_group": "Control"},
    "ds005125": {"default_group": "Control"},
    "ds005126": {"default_group": "Control"},
    "ds005128": {"default_group": "Control"},
    "ds005139": {"default_group": "Control", "sex_mapping": {1: "M", 0: "F"}},
    "ds005148": {"default_group": "Control"},
    "ds005165": {"default_group": "Control"},
    "ds005166": {
        "default_group": "Anxiety disorders, disruptive mood dysregulation disorder,"
        " or Attention deficit hyperactivity disorder"
    },
    "ds005169": {"default_group": "Drug-resistant epilepsy"},
    "ds005191": {"default_group": "Control"},
    "ds005194": {"default_group": "Control"},
    "ds005203": {"default_group": "Control"},
    "ds005216": {"default_group": "Control"},
    "ds005226": {"default_group": "Control"},
    "ds005230": {"default_group": "Control"},
    "ds005234": {"group_mapping": {"td": "Control", "asd": "Autism Spectrum Disorder"}},
    "ds005237": {"group_mapping": {"GenPop": "Control", "Patient": "Psychiatric illness"}},
    "ds005261": {"default_group": "Control"},
    "ds005267": {"default_group": "Control"},
    "ds005270": {"default_group": "Control"},
    "ds005279": {"default_group": "Control"},
    "ds005329": {"default_group": "Control"},
    "ds005341": {"group_mapping": {"CTL": "Control", "DYS": "Dyslexia"}},
    "ds005345": {"default_group": "Control"},
    "ds005346": {"default_group": "Control"},
    "ds005355": {"default_group": "Control"},
    "ds005360": {"default_group": "Control"},
    "ds005366": {"group_mapping": {"healthy": "Control", "patient": "Neurological condition(s)"}},
    "ds005371": {"default_group": "Control"},
    "ds005374": {"group_mapping": {"O": "Control", "Y": "Control"}},
    "ds005375": {"default_group": "Control"},
    "ds005381": {"default_group": "Control"},
    "ds005405": {"default_group": "Control"},
    "ds005413": {"default_group": "Control"},
    "ds005415": {"default_group": "Epilepsy"},
    "ds005418": {"default_group": "Control"},
    "ds005427": {"default_group": "Control"},
    "ds005449": {"default_group": "Control"},
    "ds005455": {"default_group": "Control"},
    "ds005460": {"default_group": "Control"},
    "ds005464": {"default_group": "Control"},
    "ds005468": {"default_group": "Control"},
    "ds005469": {"group_mapping": {"control": "Control", "military": "Control"}},
    "ds005479": {"default_group": "Control"},
    "ds005498": {
        "group_mapping": {"NTHC": "Control", "TEHC": "Control", "NTS": "Psychiatric symptoms", "TIS": "Psychiatric symptoms"},
        "sex_mapping": {2: "M", 1: "F"},
    },
    "ds005503": {"default_group": "Control"},
    "ds005518": {"group_mapping": {"unpersuaded": "Control", "persuaded": "Control"}},
    "ds005525": {"default_group": "Control"},
    "ds005529": {"default_group": "Control"},
    "ds005530": {"default_group": "Control"},
    "ds005531": {"default_group": "Control"},
    "ds005533": {"default_group": "Control"},
    "ds005551": {"default_group": "Control"},
    "ds005559": {"default_group": "Control"},
    "ds005571": {"default_group": "Control"},
    "ds005573": {"default_group": "Medically refractory epilepsy"},
    "ds005576": {"default_group": "Control"},
    "ds005581": {"default_group": "Control"},
    "ds005588": {"default_group": "Control"},
    "ds005595": {"default_group": "Control"},
    "ds005596": {"default_group": "Control"},
    "ds005597": {"default_group": "Brain tumor"},
    "ds005598": {"default_group": "Control"},
    "ds005600": {"default_group": "Control"},
    "ds005613": {"default_group": "Control"},
    "ds005619": {"default_group": "Control"},
    "ds005623": {"default_group": "Control"},
    "ds005639": {"default_group": "Control"},
    "ds005664": {"default_group": "Control"},
    "ds005684": {"default_group": "Control"},
    "ds005700": {"default_group": "Control"},
    "ds005717": {"default_group": "Control"},
    "ds005733": {"default_group": "Control"},
    "ds005737": {"default_group": "Control"},
    "ds005747": {"default_group": "Control"},
    "ds005752": {"default_group": "Control"},
    "ds005754": {
        "default_group": "Anxiety disorders, disruptive mood dysregulation disorder,"
        " or Attention deficit hyperactivity disorder"
    },
    "ds005810": {"default_group": "Control"},
    "ds005850": {"default_group": "Control"},
    "ds005874": {"group_mapping": {"Control": "Control", "Case": "Motor neuron disease"}},
    "ds005875": {"default_group": "Control"},
    "ds005880": {"default_group": "Control"},
    "ds005883": {"default_group": "Control"},
    "ds005884": {"default_group": "Control"},
    "ds005892": {
        "group_mapping": {
            "HC": "Control",
            "PD-NC": "Parkinson's disease - normal cognition",
            "PD-MCI": "Parkinson's disease - mild cognitive impairment",
        }
    },
    "ds005894": {"default_group": "Control"},
    "ds005899": {
        "group_mapping": {"0": "Control", "1": "Attention deficit hyperactivity disorder"},
        "sex_mapping": {2: "M", 1: "F"},
    },
    "ds005903": {"group_mapping": {"main": "Control"}},
    "ds005917": {"group_mapping": {"MDD": "Major depressive disorder"}},
    "ds005920": {"default_group": "Control"},
    "ds005947": {"default_group": "Control"},
    "ds005980": {"default_group": "Control"},
    "ds006005": {"default_group": "Control"},
    "ds006010": {"default_group": "Control"},
    "ds006012": {"default_group": "Control"},
    "ds006033": {"default_group": "Control"},
    "ds006039": {"default_group": "Control"},
    "ds006040": {"default_group": "Control"},
    "ds006067": {"default_group": "Control"},
    "ds006092": {"group_mapping": {"control": "Control", "experimental": "Control"}},
    "ds006105": {"default_group": "Control"},
    "ds006111": {"default_group": "Control"},
    "ds006128": {"default_group": "Control"},
    "ds006131": {"default_group": "Control"},
    "ds006156": {"group_mapping": {"con": "Control", "T1d": "Type 1 diabetes"}},
    "ds006206": {"default_group": "Control"},
    "ds006207": {"default_group": "Control"},
    "ds006211": {"default_group": "Control"},
    "ds006239": {"default_group": "Control"},
    "ds006243": {"default_group": "Control"},
    "ds006248": {"default_group": "Pituitary adenomas"},
    "ds006265": {"default_group": "Control"},
    "ds006266": {"default_group": "Control"},
    "ds006267": {"default_group": "Control"},
    "ds006334": {"default_group": "Control"},
    "ds006391": {"default_group": "Control"},
    "ds006395": {"group_mapping": {"HC": "Control", "ULD": "Upper limb dystonia", "CD": "Cervical dystonia"}},
    "ds006444": {"default_group": "Control"},
    "ds006472": {"group_mapping": {"control": "Control", "DP": "Developmental prosopagnosics"}},
}


def main(
    path: str = get_source_path(),
    subdir: str = "OpenNeuro",
    processes=12,
    bidsify=False,
    save_dset_metadata=False,
    save_as_tensor=False,
):
    saving_config = get_FOMO300K_saving_config(
        save_as_tensor=save_as_tensor, save_dset_metadata=save_dset_metadata, bidsify=bidsify
    )
    preprocessing_config = get_noresampling_preprocessing_config()

    process(
        saving_config=saving_config,
        preprocessing_config=preprocessing_config,
        path=path,
        subdir=subdir,
        processes=processes,
    )


def process(
    saving_config,
    preprocessing_config,
    path: str = get_source_path(),
    subdir: str = "OpenNeuro",
    processes=12,
    task_name: str = "PT030_OpenNeuro",
):
    """Process all datasets in the OpenNeuro directory."""
    dataset_config = DatasetConfig(
        task_name=task_name,
        n_classes=1,
        n_modalities=1,
        in_extensions=[".nii.gz", ".nii"],
        split=None,
        patterns_exclusion=[
            "func",
            "fmap",
            "derivatives",
            "derivative",
            "freesurfer",
            "sourcedata",
            "code",
            "mask",
            "label",
            "dseg",
            "probseg",
            "Workshopfiles",
            "calibration",
            "histology",
            "MNI152",
            "BOLD",
            "bold",
            "tmp",
            "processed_mri_data",
            "excluded",
            "fmri",
            "-phase",
            "QSM",
            "qsm",
            "mrs",
            "_CT",
            "_ct",
            "_roi",
            "_ROI",
            "dixon",
        ],
        patterns_DWI=["dwi"],
        patterns_PET=["18FFDG", "_pet", "trc-18FAV45"],
        patterns_perfusion=["asl", "m0scan", "MZero"],
        patterns_m0=["m0scan", "MZero"],
        patterns_bidsify=[r"sub-([A-Za-z0-9]+)"],
        df_columns=["participant_id", "session_id", "age", "sex", "group", "handedness"],
    )

    source_dir = os.path.join(path, subdir)
    target_dir = os.path.join(get_data_path(), dataset_config.task_name)

    # Find all dataset directories (ds followed by 7 digits)
    dataset_dirs = []
    for item in os.listdir(source_dir):
        item_path = os.path.join(source_dir, item)
        if os.path.isdir(item_path) and item.startswith("ds") and len(item) == 8 and item[2:].isdigit():
            dataset_dirs.append((item_path, item))

    print(f"Found {len(dataset_dirs)} datasets to process")

    processed_datasets = []
    failed_datasets = []

    for dataset_path, dataset_name in dataset_dirs:
        try:
            result = process_single_dataset(
                dataset_config=dataset_config,
                preprocessing_config=preprocessing_config,
                saving_config=saving_config,
                source_dir=dataset_path,
                target_dir=target_dir,
                dataset_name=dataset_name,
                processes=processes,
            )
            if result:
                processed_datasets.append(result)
            else:
                failed_datasets.append(dataset_name)
        except Exception as e:
            print(f"Error processing {dataset_name}: {e}")
            failed_datasets.append(dataset_name)

    postprocess_standard_dataset(
        dataset_config=dataset_config,
        preprocessing_config=preprocessing_config,
        saving_config=saving_config,
        target_dir=target_dir,
        source_files_standard=[],
        source_files_DWI=[],
        source_files_PET=[],
        source_files_Perf=[],
        source_files_excluded=[],
        processes=processes,
    )
    print(f"\nProcessing complete!")
    print(f"Successfully processed: {len(processed_datasets)} datasets")
    print(f"Failed: {len(failed_datasets)} datasets")

    if failed_datasets:
        print(f"Failed datasets: {failed_datasets}")


def process_single_dataset(
    dataset_config,
    preprocessing_config,
    saving_config,
    source_dir,
    target_dir,
    dataset_name,
    processes=12,
):
    """Process a single OpenNeuro dataset."""
    print(f"Processing dataset: {dataset_name}")

    target_dir = os.path.join(target_dir, dataset_name)
    os.makedirs(target_dir, exist_ok=True)

    files_standard, files_DWI, files_PET, files_Perf, files_excluded = recursive_find_and_group_files(
        source_dir,
        extensions=dataset_config.in_extensions,
        patterns_dwi=dataset_config.patterns_DWI,
        patterns_pet=dataset_config.patterns_PET,
        patterns_perfusion=dataset_config.patterns_perfusion,
        patterns_exclusion=dataset_config.patterns_exclusion,
        processes=processes,
    )

    files_standard_out = get_image_output_paths(files_standard, source_dir, target_dir, dataset_config.in_extensions)
    files_DWI_out = get_image_output_paths(files_DWI, source_dir, target_dir, dataset_config.in_extensions)
    files_PET_out = get_image_output_paths(files_PET, source_dir, target_dir, dataset_config.in_extensions)
    files_Perf_out = get_image_output_paths(files_Perf, source_dir, target_dir, dataset_config.in_extensions)
    bvals_DWI, bvecs_DWI = get_bvals_and_bvecs_v1(files_DWI, dataset_config.in_extensions)

    multiprocess_mri_dwi_pet_perf_cases(
        files_standard=files_standard,
        files_standard_out=files_standard_out,
        files_DWI=files_DWI,
        bvals_DWI=bvals_DWI,
        bvecs_DWI=bvecs_DWI,
        files_DWI_out=files_DWI_out,
        files_PET=files_PET,
        files_PET_out=files_PET_out,
        files_Perf=files_Perf,
        files_Perf_out=files_Perf_out,
        patterns_m0=dataset_config.patterns_m0,
        preprocessing_config=preprocessing_config,
        saving_config=saving_config,
        processes=processes,
        strict=False,
    )

    if saving_config.bidsify or saving_config.save_dset_metadata:
        processed_files = recursive_find_files(target_dir, extensions=dataset_config.in_extensions + [".pt"])

        if not processed_files:
            print(f"Warning: No files processed, remove dataset directory")
            shutil.rmtree(target_dir)
            return None

        participants_file = os.path.join(source_dir, "participants.tsv")
        if not os.path.exists(participants_file):
            print(f"Warning: No participants.tsv found in {dataset_name}")

        # Get dataset-specific configuration
        dataset_custom_config = DATASET_SPECIFIC_CONFIGS.get(dataset_name, {})

        expanded_df, subjects_df, mri_info_df = extract_demographics(
            processed_files=processed_files,
            demographics_csv_path=participants_file,
            columns_to_keep=dataset_config.df_columns,
            custom_patterns=dataset_config.patterns_bidsify,
            sex_mapping=dataset_custom_config.get("sex_mapping"),
            handedness_mapping=dataset_custom_config.get("handedness_mapping"),
            group_mapping=dataset_custom_config.get("group_mapping"),
            default_group=dataset_custom_config.get("default_group"),
            source_dir=source_dir,
            target_dir=target_dir,
            modality_patterns=dataset_custom_config.get("modality_patterns"),
        )

        if saving_config.bidsify:
            subjects_df.to_csv(os.path.join(target_dir, "participants.tsv"), sep='\t', index=False)

            mapping_df = rename_files_with_mapping(
                target_dir=target_dir,
                expanded_df=expanded_df,
                modality_patterns=dataset_custom_config.get("modality_patterns"),
            )

        if saving_config.bidsify or saving_config.save_dset_metadata:
            mri_info_df.to_csv(os.path.join(target_dir, "mri_info.tsv"), sep='\t', index=False)

    postprocess_standard_dataset(
        dataset_config=dataset_config,
        preprocessing_config=preprocessing_config,
        saving_config=saving_config,
        target_dir=target_dir,
        source_files_standard=files_standard,
        source_files_DWI=files_DWI,
        source_files_PET=files_PET,
        source_files_Perf=files_Perf,
        source_files_excluded=files_excluded,
        processes=processes,
    )

    print(f"Completed processing dataset: {dataset_name}")
    return dataset_name


if __name__ == "__main__":
    args = asparagus_parser.parse_args()
    main(
        processes=args.num_workers,
        bidsify=args.bidsify,
        save_dset_metadata=args.save_dset_metadata,
        save_as_tensor=args.save_as_tensor,
    )
